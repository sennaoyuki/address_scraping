# ユニバーサル店舗情報スクレイピングツール

あらゆるウェブサイトから店舗情報（店舗名、住所、アクセス情報、電話番号、営業時間）を自動収集し、CSV形式でダウンロードできるWebアプリケーションです。

## 特徴

### 🌟 ユニバーサル対応
- **インテリジェントな情報抽出**: パターン認識と構造解析により、どんなウェブサイトからでも店舗情報を自動抽出
- **多層抽出戦略**: 正規表現、HTML構造解析、JSON-LD、ヒューリスティック検出を組み合わせた高精度な抽出
- **信頼度スコアリング**: 各抽出情報に信頼度スコアを付与し、データ品質を可視化

## 機能

- 店舗一覧ページから自動的に各店舗の詳細情報を収集
- 以下の情報を自動抽出:
  - 店舗名
  - 住所（郵便番号含む）
  - アクセス情報（最寄り駅からの徒歩分数）
  - 電話番号
  - 営業時間
- 収集したデータをCSV形式でダウンロード
- 進捗状況のリアルタイム表示

## 対応サイト

### 完全対応（レガシーサポート）
- DIOクリニック
- エミナルクリニック
- フレイアクリニック
- リゼクリニック
- 聖心美容クリニック
- SBC湘南美容クリニック

### ユニバーサル対応
- **すべてのウェブサイト**: インテリジェント抽出エンジンにより、事前の設定なしに店舗情報を抽出可能

## 使い方

### ローカル環境での実行

1. 必要なパッケージをインストール
```bash
pip install -r requirements.txt
```

2. アプリケーションを起動
```bash
python app.py
```

3. ブラウザで `http://localhost:5000` にアクセス

4. クリニックの店舗一覧ページまたは個別店舗ページのURLを入力

5. 「スクレイピング開始」ボタンをクリック

6. 完了後、CSVファイルをダウンロード

## 出力形式

CSVファイルには以下の情報が含まれます：

- 店舗名
- 住所（郵便番号含む）
- アクセス（最寄り駅からの徒歩分数）
- 電話番号（取得できた場合）
- 営業時間（取得できた場合）
- URL（情報取得元）

## ファイル構成

### コアモジュール
- `universal_scraper.py` - ユニバーサル店舗情報抽出エンジン
  - `PatternMatcher` - パターンマッチング処理
  - `StructuralAnalyzer` - HTML構造解析
  - `IntelligentExtractor` - インテリジェント抽出エンジン
  - `UniversalStoreScraper` - メインスクレイパークラス

### アプリケーション
- `app.py` - Flaskアプリケーション本体
- `clinic_info_scraper.py` - 店舗情報スクレイピングモジュール
- `api/app.py` - Vercelデプロイ用APIエンドポイント

### ユーティリティ
- `test_universal_scraper.py` - ユニバーサルスクレイパーのテストスクリプト
- `UNIVERSAL_SCRAPER_GUIDE.md` - 詳細な技術ドキュメント

### フロントエンド
- `templates/index.html` - フロントエンドHTML
- `static/js/main.js` - フロントエンドJavaScript
- `static/css/style.css` - スタイルシート

## 技術的な特徴

### インテリジェント抽出アルゴリズム

1. **多層パターンマッチング**
   - 住所: 郵便番号、都道府県、市区町村、建物名を含む複数パターン
   - アクセス: 駅名＋徒歩時間、最寄り駅、路線情報
   - 電話: 様々な形式（ハイフン有無、市外局番など）
   - 営業時間: 平日/休日、時間帯表記の各種パターン

2. **構造解析**
   - HTMLテーブル（table/tr/td）の自動認識
   - 定義リスト（dl/dt/dd）の解析
   - セマンティックコンテナの検出

3. **信頼度スコアリング**
   - 各抽出結果に0-100の信頼度スコアを付与
   - 複数の抽出方法の結果を統合して最適な結果を選択

4. **フォールバック戦略**
   - プライマリ抽出が失敗した場合の代替手段
   - 部分一致や文脈からの推測

### パフォーマンス最適化

- 効率的なDOM traversal
- 正規表現のコンパイル済みパターン使用
- 重複除去と結果キャッシング

## 注意事項

- スクレイピングは対象サイトの利用規約を確認の上、適切に使用してください
- サーバーに負荷をかけないよう、適切な間隔でアクセスするようにしています
- 収集したデータは個人使用の範囲でご利用ください

### 既知の問題

- **フレイアクリニック**: ~~Vercel環境では住所・アクセス情報の抽出に制限があります。ローカル環境では正常に動作します。~~ (解決済み: vercel.json修正により正常動作)
- **TCB東京中央美容外科**: Vercel環境ではアクセス制限により情報取得ができません。ローカル環境では正常に動作します。

## ライセンス

本プロジェクトはMITライセンスで公開されています。